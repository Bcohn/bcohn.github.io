m <- 20
n <- 5
mat <- matrix(runif(m*n), nrow=m, ncol=n)
rownames(mat) <- replicate(m, paste0(sample(LETTERS, 3, replace=T), collapse=''))
plot(hclust(dist(mat)), main="Analysis of equties reveals\nactionable investment guidance")
rownames(mat) <- replicate(m, paste0(sample(LETTERS, 3, replace=T), collapse=''))
plot(hclust(dist(mat)), main="Analysis of equties reveals\nactionable investment guidance")
plot(hclust(dist(mat)), main="Analysis of equties reveals\nactionable investment guidance")
plot(hclust(dist(mat)), main="Analysis of equties reveals\nactionable investment guidance")
x<-c(1,4,5,5) #fake data
y<-c(2,4,5,4) #fake data
data<-data.frame(x,y) #fake data
plot_data1<-function(data,ymax){
par(pty="s")# make the plot a square
plot(data,
type = "l", lwd=2,
xaxt="n", yaxt="n", xaxs="i", yaxs="i", ylim=c(0,ymax))
my_at<- c(0,10,20,30,40,50,60,70,80,90)
axis(side=1, at= my_at, outer=TRUE)
axis(side=2,
outer=TRUE)
}
plot_data2<-function(data,ymax){
par(pty="s")
plot(data,type = "l", lwd=2,xaxt="n", yaxt="n", xaxs="i",         yaxs="i",ylim=c(0,ymax))
my_at<- c(0,10,20,30,40,50,60,70,80,90)
#axis(side=1, at= my_at, outer=TRUE)
#axis(side=2,
#    outer=TRUE)
}
plot_data3<-function(data,ymax){
par(pty="s")
plot(data,type = "l", lwd=2,xaxt="n", yaxt="n", xaxs="i", yaxs="i", ylim=c(0,ymax))
my_at<- c(0,10,20,30,40,50,60,70,80,90)
axis(side=1, at= my_at, outer=TRUE)
axis(side=2,
outer=TRUE)
}
plot_data4<-function(data,ymax){
par(pty="s")
plot(data,
type = "l", lwd=2,xaxt="n", yaxt="n", xaxs="i", yaxs="i", ylim=c(0,ymax))
my_at<- c(0,10,20,30,40,50,60,70,80,90)
axis(side=1, at= my_at, outer=TRUE)
#axis(side=2,
#    outer=TRUE)
}
twobytwo<-function(data,ymax){
nf <- layout(matrix(c(1,2,3,4), 2, 2, byrow = TRUE), respect = TRUE) # for the two by two layout
layout.show(nf) # the two by two layout we want
nf
plot_data1(data,ymax)
plot_data2(data,ymax)
plot_data3(data,ymax)
plot_data4(data,ymax)
title(xlab = "Age (years)",
ylab = "Probability Density",
outer = TRUE, line = 3)
}
twobytwo(data,ymax=9)
plot_data1<-function(data,ymax){
par(pty="s")# make the plot a square
plot(data,
type = "l", lwd=2,
xaxt="n", yaxt="n", xaxs="i", yaxs="i",ylab='', ylim=c(0,ymax))
my_at<- c(0,10,20,30,40,50,60,70,80,90)
axis(side=1, at= my_at, outer=TRUE)
axis(side=2,
outer=TRUE)
}
plot_data2<-function(data,ymax){
par(pty="s")
plot(data,type = "l", lwd=2,xaxt="n", yaxt="n", xaxs="i", ylab='',     yaxs="i",ylim=c(0,ymax))
my_at<- c(0,10,20,30,40,50,60,70,80,90)
#axis(side=1, at= my_at, outer=TRUE)
#axis(side=2,
#    outer=TRUE)
}
plot_data3<-function(data,ymax){
par(pty="s")
plot(data,type = "l", lwd=2,xaxt="n", yaxt="n", xaxs="i",ylab='', yaxs="i", ylim=c(0,ymax))
my_at<- c(0,10,20,30,40,50,60,70,80,90)
axis(side=1, at= my_at, outer=TRUE)
axis(side=2,
outer=TRUE)
}
plot_data4<-function(data,ymax){
par(pty="s")
plot(data,
type = "l", lwd=2,xaxt="n", yaxt="n", xaxs="i", ylab='',yaxs="i", ylim=c(0,ymax))
my_at<- c(0,10,20,30,40,50,60,70,80,90)
axis(side=1, at= my_at, outer=TRUE)
#axis(side=2,
#    outer=TRUE)
}
twobytwo<-function(data,ymax){
nf <- layout(matrix(c(1,2,3,4), 2, 2, byrow = TRUE), respect = TRUE) # for the two by two layout
layout.show(nf) # the two by two layout we want
nf
plot_data1(data,ymax)
plot_data2(data,ymax)
plot_data3(data,ymax)
plot_data4(data,ymax)
title(xlab = "Age (years)",
ylab = "Probability Density",
outer = TRUE, line = 3)
}
twobytwo(data,ymax=9)
dat=read.csv("~/Downloads/running.csv")
head(dat)
str(dat)
dat$arrival_time=as.Date(dat$arrival_time)
head(dat$arrival_time)
dat$arrival_time=as.Date(as.character(dat$arrival_time))
dat$arrival_time=as.POSIXct(as.character(dat$arrival_time))
dat$arrival_time=as.POSIXct(as.character(dat$arrival_time),format='%H:%M')
head(dat)
dat[1,]$arrival_time-dat[3,]$arrival_time
as.numeric(dat[1,]$arrival_time-dat[3,]$arrival_time)
str(dat)
asdf=dat%>%filter(stop_sequence==1 | stop_sequence==28 | stop_sequence==26)%>%group_by(trippieceid,directionid)
library(dplyr)
asdf=dat%>%filter(stop_sequence==1 | stop_sequence==28 | stop_sequence==26)%>%group_by(trippieceid,directionid)
head(asdf)
dim(asdf)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))
asdf
table(asdf$stop_sequence)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(players, G_delta = G - lag(G))
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(G_delta = arrival_time- lag(arrival_time))
head(asdf)
head(asdf$G_delta)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(G_delta = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)
asdf
asdf=asdf[,c("directionid","trippieceid","time_diff")]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)
asdf=asdf[,c("directionid","trippieceid","time_diff")]
head(asdf)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))
asdf
42405378
asdf[asdf$trippieceid=="42405378"]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))
asdf[asdf$trippieceid=="42405378"]
names(asdf[asdf$trippieceid=="42405378"])
dat$arrival_time=as.POSIXct(as.character(dat$arrival_time),format='%H:%M')
as.numeric(dat[1,]$arrival_time-dat[3,]$arrival_time)
names(asdf)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))
dim(asdf)
names(asdf[asdf$trippieceid=="42405378"])
dim(asdf)
asdf[asdf$trippieceid=="42405378",]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)
asdf=asdf[,c("directionid","trippieceid","time_diff")]
head(asdf)
dat$arrival_time=as.POSIXct(as.character(dat$arrival_time),format='%H:%M')
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)
asdf=asdf[,c("directionid","trippieceid","time_diff")]
head(adf)
head(asdf)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)
asdf
head(asdf$time_diff)
str(asdf)
str(dat)
dat=read.csv("~/Downloads/running.csv")
library(dplyr)
dat$arrival_time=as.POSIXct(as.character(dat$arrival_time),format='%H:%M')
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)
asdf=asdf[,c("directionid","trippieceid","time_diff")]
head(asdf)
table(asdf$time_diff)
ggplot(data=asdf,aes(x=time_diff))+geom_histogram()
library(ggplot2)
ggplot(data=asdf,aes(x=time_diff))+geom_histogram()
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf[time_diff<0,]$time_dif* asdf[time_diff<0,]$time_diff*-1
asdf[asdf$time_diff<0,]$time_dif* asdf[asdf$time_diff<0,]$time_diff*-1
asdf[asdf$time_diff<0,]$time_dif= as.numeric(asdf[asdf$time_diff<0,]$time_diff)*-1
asdf$time_diff=as.numeric(asdf$time_diff)
asdf[asdf$time_diff<0,]$time_dif= (asdf[asdf$time_diff<0,]$time_diff)*-1
asdf=asdf[,c("directionid","trippieceid","time_diff")]
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf$time_diff=as.numeric(asdf$time_diff)
asdf[asdf$time_diff<0,]$time_dif= (asdf[asdf$time_diff<0,]$time_diff)*-1
asdf[asdf$time_diff<0,]$time_dif
(asdf[asdf$time_diff<0,]$time_diff)*-1
asdf[asdf$time_diff<0,]$time_dif= (asdf[asdf$time_diff<0,]$time_diff)*-1
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)%>%
mutate(time_diff=as.numeric(time_diff))
asdf$time_diff=abs(as.numeric(asdf$time_diff))
asdf=asdf[,c("directionid","trippieceid","time_diff")]
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
head(asdf)
asdf[asdf$time_diff==0]
setDT(asdf)
library(data.table)
setDT(asdf)
asdf[time_diff==0]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)%>%
mutate(time_diff=as.numeric(time_diff))
asdf$time_diff=abs(as.numeric(asdf$time_diff))
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
head(adsf)
head(asdf)
table(asdf$time_diff)
asdf[time_diff==1]
setDT(asdf)
asdf[time_diff==1]
dat[trippieceid==42409486]
dat[trippieceid==42409486]
setDT(dat)
dat[trippieceid==42409486]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = difftime(arrival_time,lag(arrival_time,units="minutes")))%>%filter(stop_sequence!=1)%>%
mutate(time_diff=as.numeric(time_diff))
asdf$time_diff=abs(as.numeric(asdf$time_diff))
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = difftime(arrival_time,lag(arrival_time,units="minutes"))
)
head(asdf$time_diff)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = difftime(arrival_time,lag(arrival_time,units="minutes")))%>%filter(stop_sequence!=1)%>%
mutate(time_diff=as.numeric(time_diff))
head(asdf$time_diff)
table(asdf$time_diff)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = difftime(arrival_time,lag(arrival_time,units="minutes")))
table(asdf$time_diff)
asdf
asdf$time_diff
str(asdf)
?difftime
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = difftime(arrival_time,lag(arrival_time,units="min")))%>%filter(stop_sequence!=1)%>%
mutate(time_diff=as.numeric(time_diff))
asdf$time_diff=abs(as.numeric(asdf$time_diff))
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = difftime(arrival_time,lag(arrival_time,units="min")))%>%filter(stop_sequence!=1)%>%
mutate(time_diff=as.numeric(time_diff))
head(asdf)
table(asdf$time_diff)
head(asdf)
head(asdf,n=50)
setDT(dat)
dat[trippieceid==42405641]]
setDT(dat)
dat[trippieceid==42405641]
dat[trippieceid==42405641]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%summarize(
result=max(arrival_time)=min(arrival_time))
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%summarize(
result=max(arrival_time)-min(arrival_time))
head(asdf)
ggplot(data=asdf,aes(x=as.numeric(result)))+geom_histogram()
head(asdf,n=50)
dat[trippieceid==42405386]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))
setDT(asdf)
asdf[trippieceid==42405386]
asdf[trippieceid==42405386]%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%summarize(
result=max(arrival_time)-min(arrival_time))
asdf[trippieceid==42405386]%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%summarize(
result=difftime(max(arrival_time),min(arrival_time),units="mins")
)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%summarize(
result=difftime(max(arrival_time),min(arrival_time),units="mins")
ggplot(data=asdf,aes(x=as.numeric(result)))+geom_histogram()
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%summarize(
result=difftime(max(arrival_time),min(arrival_time),units="mins")
)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%summarize(
result=difftime(max(arrival_time),min(arrival_time),units="mins"))
head(adsf)
head(asdf)
ggplot(data=asdf,aes(x=as.numeric(result)))+geom_histogram()
asdf$result2=as.numeric(asdf$result)
ggplot(data=asdf,aes(x=as.numeric(result2)))+geom_histogram()
asdf
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = difftime(arrival_time,lag(arrival_time,units="mins")))%>%filter(stop_sequence!=1)%>%
mutate(time_diff=as.numeric(time_diff))
asdf$time_diff=abs(as.numeric(asdf$time_diff))
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = difftime(arrival_time,lag(arrival_time,units="mins")))
head9asdf)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = difftime(arrival_time,lag(arrival_time,units="mins")))%>%filter(stop_sequence!=1)
head(asdf)
head(asdf,n=50)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = difftime(arrival_time,lag(arrival_time),units="mins"))%>%filter(stop_sequence!=1)%>%
mutate(time_diff=as.numeric(time_diff))
asdf$time_diff=abs(as.numeric(asdf$time_diff))
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf
head(asdf)
dat[trippieceid==42405378]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)%>%mutate(time_diff = as.difftime(time_diff,units="mins"))%>%
mutate(time_diff=as.numeric(time_diff))
asdf$time_diff=abs(as.numeric(asdf$time_diff))
head(asdf)
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)%>%mutate(time_diff = as.difftime(time_diff,units="mins"))
asdf
asdf$time_diff
head(asdf,n=50)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)%>%mutate(time_diff = as.difftime(time_diff,units="mins"))%>%
mutate(time_diff=as.numeric(time_diff, units = "mins")
asdf$time_diff=abs(as.numeric(asdf$time_diff))
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)%>%mutate(time_diff = as.difftime(time_diff,units="mins"))%>%
mutate(time_diff=as.numeric(time_diff, units = "mins"))
asdf$time_diff=abs(as.numeric(asdf$time_diff))
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)%>%
mutate(time_diff=as.numeric(time_diff, units = "mins"))
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf$time_diff=abs(as.numeric(asdf$time_diff))
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)%>%
mutate(time_diff=as.numeric(time_diff, units = "mins"))
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
asdf$time_diff=abs(as.numeric(asdf$time_diff))
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
setDT(asdf)
asdf[time_diff<5,time_diff:=time_diff*60]
ggplot(data=asdf,aes(x=as.numeric(time_diff)))+geom_histogram()
head(asdf)
ggplot(data=asdf,aes(x=as.numeric(time_diff),color=directionid))+geom_histogram()
ggplot(data=asdf,aes(x=as.numeric(time_diff),fill=directionid))+geom_histogram()
head(asdf$directionid)
asdf=asdf[,c("directionid","trippieceid","time_diff"),with=FALSE]
head(asdf)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)%>%
mutate(time_diff=as.numeric(time_diff, units = "mins"))
asdf$time_diff=abs(as.numeric(asdf$time_diff))
setDT(asdf)
asdf[time_diff<5,time_diff:=time_diff*60]
head(asdf)
dim(asdf)
write(asdf,file="forKati.csv")
write.csv(asdf,file="forKati.csv")
sum(is.na(asdf))
head(asdf)
head(asdf[is.na(timediff)])
setDT(asdf)
head(asdf[is.na(timediff)])
head(asdf[is.na(time_diff)])
dat[trippieceid==42405524]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)
asdf$time_diff=abs(as.numeric(asdf$time_diff))
setDT(asdf)
sum(is.na(asdf$time_diff))
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))
head(asdf)
head(asdf,n=50)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)
head(asf,n=50)
head(asdf,n=50)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))
asdf[trippieceid==42405524]
asdf[trippieceid==42405524]$time_diff
dat[trippieceid==42405524]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==1 |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))
head(asdf)
asdf[trippieceid==42405524]$time_diff
dat[trippieceid==42405524]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==min(stop_sequence) |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))
table(asdf$stop_sequence)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==min(stop_sequence) |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(stop_sequence!=1)
asdf$time_diff=abs(as.numeric(asdf$time_diff))
setDT(asdf)
asdf[time_diff<5,time_diff:=time_diff*60]
sum(is.na(asdf))
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==min(stop_sequence) |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))
head(asdf)
sum(is.na(asdf))
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==min(stop_sequence) |stop_sequence==max(stop_sequence))%>%
mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(!is.na(time_diff))
dim(asdf)
length(unique(dat$trippieceid))
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==min(stop_sequence) |stop_sequence==max(stop_sequence))%>%
%>%arrange(trippieceid,directionid)%>% mutate(time_diff = arrival_time- lag(arrival_time))
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==min(stop_sequence) |stop_sequence==max(stop_sequence))%>%
arrange(trippieceid,directionid)%>% mutate(time_diff = arrival_time- lag(arrival_time))
dim(asdf)
head(asdf)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==min(stop_sequence) |stop_sequence==max(stop_sequence))%>%
arrange(trippieceid,directionid)%>% mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(!is.na(time_diff))
dim(asdf)
length(unique(dat$trippieceid))
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==min(stop_sequence) |stop_sequence==max(stop_sequence))%>%
arrange(trippieceid,directionid,stop_sequence)
head(asdf)
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==min(stop_sequence) |stop_sequence==max(stop_sequence))%>%
arrange(trippieceid,directionid,stop_sequence)%>% mutate(time_diff = arrival_time- lag(arrival_time))
head(asdf)
head(asdf$time_diff,n=100)
head(asdf,n=55)
head(asdf,n=59)
dat[trippieceid==42405527]
dat=read.csv("~/Downloads/running.csv")
library(dplyr)
dat$arrival_time=as.POSIXct(as.character(dat$arrival_time),format='%H:%M')
dat[trippieceid==42405527]
setDT(dat)
dat[trippieceid==42405527]
asdf=dat%>%group_by(trippieceid,directionid)%>%filter(stop_sequence==min(stop_sequence) |stop_sequence==max(stop_sequence))%>%
arrange(trippieceid,directionid,stop_sequence)%>% mutate(time_diff = arrival_time- lag(arrival_time))%>%filter(!is.na(time_diff))
asdf$time_diff=abs(as.numeric(asdf$time_diff))
setDT(asdf)
asdf[time_diff<5,time_diff:=time_diff*60]
write.csv(asdf,file="forKati.csv")
ggplot(data=asdf,aes(x=as.numeric(time_diff),fill=directionid))+geom_histogram()
write.csv(asdf,file="forKati2.csv")
